<!-- wiki/templates/wiki/article_list.html -->
{% extends "homepage.html" %} 

{% block content %}
    <h1>Wiki Articles</h1>

    {% if user.is_authenticated %}
        <p><a href="{{ create_article_url }}">Create New Article</a></p>

        {% if user_articles %}
            <h2>My Articles</h2>
            <ul>
                {% for article in user_articles %}
                    <li>
                        <a href="{{ article.get_absolute_url }}">{{ article.title }}</a>
                        (Category: {{ article.category.name|default:"Uncategorized" }})
                    </li>
                {% endfor %}
            </ul>
            <hr>
        {% endif %}
    {% endif %}

    <h2>All Articles</h2>
    {% if categories_with_articles %}
        {% for category in categories_with_articles %}
            {% if category.articles.all %} {# Only show category if it has (non-user) articles #}
                <h3>{{ category.name }}</h3>
                <ul>
                    {% for article in category.articles.all %}
                        <li>
                            <a href="{{ article.get_absolute_url }}">{{ article.title }}</a>
                        </li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endfor %}
    {% else %}
         <p>No articles found{% if user.is_authenticated %} (apart from your own){% endif %}.</p>
    {% endif %}

{% endblock %}